import{U as ne,a as ie,g as re,r as n,j as e,c as g,C as xe,A as le,B as F,$ as he,b as $,d as I,e as P,f as O,E as K,h as Q,i as Y,k as X,l as pe,n as fe,u as Z,m as je,I as L,o as Ne,p as ge,q as ve,L as Ce,S as q,s as h,t as ee,P as be,v as we,w as Se,x as W,y as G,z as se,D as _e,F as te}from"./index-cFUSqVej.js";import{u as Ee}from"./use-post-add-user-DZzkcxGI.js";const ye=r=>{const{mutate:l}=ne();return l(["useDeleteUsers"],async({user_id:p})=>(await ie.delete(`${re("USERS")}/${p}`)).data,r)},Ue=r=>{const{mutate:l}=ne();async function c({skip:p,limit:v}){const a=await ie.get(`${re("USERS")}/?skip=${p}&limit=${v}`);return a.status===200?a.data:[]}return l(["useGetUsers"],c,r)},ce=n.forwardRef(({className:r,...l},c)=>e.jsx("div",{className:"",children:e.jsx("table",{ref:c,className:g("w-full caption-bottom text-sm",r),...l})}));ce.displayName="Table";const oe=n.forwardRef(({className:r,...l},c)=>e.jsx("thead",{ref:c,className:g("[&_tr]:border-b",r),...l}));oe.displayName="TableHeader";const de=n.forwardRef(({className:r,...l},c)=>e.jsx("tbody",{ref:c,className:g("[&_tr:last-child]:border-0",r),...l}));de.displayName="TableBody";const Te=n.forwardRef(({className:r,...l},c)=>e.jsx("tfoot",{ref:c,className:g("bg-primary font-medium text-primary-foreground",r),...l}));Te.displayName="TableFooter";const J=n.forwardRef(({className:r,...l},c)=>e.jsx("tr",{ref:c,className:g("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...l}));J.displayName="TableRow";const j=n.forwardRef(({className:r,...l},c)=>e.jsx("th",{ref:c,className:g("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...l}));j.displayName="TableHead";const N=n.forwardRef(({className:r,...l},c)=>e.jsx("td",{ref:c,className:g("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...l}));N.displayName="TableCell";const Re=n.forwardRef(({className:r,...l},c)=>e.jsx("caption",{ref:c,className:g("mt-4 text-sm text-muted-foreground",r),...l}));Re.displayName="TableCaption";function ae({title:r,titleHeader:l,cancelText:c,confirmationText:E,children:p,icon:v,data:a,index:C,onConfirm:z,asChild:B}){const H=fe[v],[b,w]=n.useState(!1),[S,u]=n.useState(!1),[y,x]=n.useState(!1),[f,_]=n.useState((a==null?void 0:a.password)??""),[U,T]=n.useState((a==null?void 0:a.username)??""),[m,M]=n.useState((a==null?void 0:a.password)??""),[R,D]=n.useState((a==null?void 0:a.is_active)??!1),[A,k]=n.useState((a==null?void 0:a.is_superuser)??!1),[V,s]=n.useState(xe),{userData:t}=n.useContext(le);function i({target:{name:o,value:me}}){s(ue=>({...ue,[o]:me}))}n.useEffect(()=>{y&&(a?(T(a.username),D(a.is_active),k(a.is_superuser),i({target:{name:"username",value:U}}),i({target:{name:"is_active",value:R}}),i({target:{name:"is_superuser",value:A}})):d())},[y]);function d(){_(""),T(""),M(""),D(!1),k(!1)}return e.jsxs(F,{size:"medium-h-full",open:y,setOpen:x,children:[e.jsx(F.Trigger,{asChild:B,children:p}),e.jsxs(F.Header,{description:l,children:[e.jsx("span",{className:"pr-2",children:r}),e.jsx(H,{name:"icon",className:"h-6 w-6 pl-1 text-foreground","aria-hidden":"true"})]}),e.jsx(F.Content,{children:e.jsxs(he,{onSubmit:o=>{if(f!==m){o.preventDefault();return}d(),z(1,V),x(!1),o.preventDefault()},children:[e.jsxs("div",{className:"grid gap-5",children:[e.jsxs($,{name:"username",children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(I,{className:"data-[invalid]:label-invalid",children:["Username"," ",e.jsx("span",{className:"font-medium text-destructive",children:"*"})]})}),e.jsx(P,{asChild:!0,children:e.jsx("input",{onChange:({target:{value:o}})=>{i({target:{name:"username",value:o}}),T(o)},value:U,className:"primary-input",required:!0,placeholder:"Username"})}),e.jsx(O,{match:"valueMissing",className:"field-invalid",children:"Please enter your username"})]}),e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"mr-3 basis-1/2",children:e.jsxs($,{name:"password",serverInvalid:f!=m,children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(I,{className:"data-[invalid]:label-invalid flex",children:["Password"," ",e.jsx("span",{className:"ml-1 mr-1 font-medium text-destructive",children:"*"}),b&&e.jsx(K,{onClick:()=>w(!b),className:"h-5 cursor-pointer",strokeWidth:1.5}),!b&&e.jsx(Q,{onClick:()=>w(!b),className:"h-5 cursor-pointer",strokeWidth:1.5})]})}),e.jsx(P,{asChild:!0,children:e.jsx("input",{onChange:({target:{value:o}})=>{i({target:{name:"password",value:o}}),_(o)},value:f,className:"primary-input",required:!a,type:b?"text":"password"})}),e.jsx(O,{className:"field-invalid",match:"valueMissing",children:"Please enter a password"}),f!=m&&e.jsx(O,{className:"field-invalid",children:"Passwords do not match"})]})}),e.jsx("div",{className:"basis-1/2",children:e.jsxs($,{name:"confirmpassword",serverInvalid:f!=m,children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(I,{className:"data-[invalid]:label-invalid flex",children:["Confirm password"," ",e.jsx("span",{className:"ml-1 mr-1 font-medium text-destructive",children:"*"}),S&&e.jsx(K,{onClick:()=>u(!S),className:"h-5 cursor-pointer",strokeWidth:1.5}),!S&&e.jsx(Q,{onClick:()=>u(!S),className:"h-5 cursor-pointer",strokeWidth:1.5})]})}),e.jsx(P,{asChild:!0,children:e.jsx("input",{onChange:o=>{M(o.target.value)},value:m,className:"primary-input",required:!a,type:S?"text":"password"})}),e.jsx(O,{className:"field-invalid",match:"valueMissing",children:"Please confirm your password"})]})})]}),e.jsxs("div",{className:"flex gap-8",children:[e.jsx($,{name:"is_active",children:e.jsxs("div",{children:[e.jsx(I,{className:"data-[invalid]:label-invalid mr-3",children:"Active"}),e.jsx(P,{asChild:!0,children:e.jsx(Y,{value:R,checked:R,id:"is_active",className:"relative top-0.5",onCheckedChange:o=>{i({target:{name:"is_active",value:o}}),D(o)}})})]})}),(t==null?void 0:t.is_superuser)&&e.jsx($,{name:"is_superuser",children:e.jsxs("div",{children:[e.jsx(I,{className:"data-[invalid]:label-invalid mr-3",children:"Superuser"}),e.jsx(P,{asChild:!0,children:e.jsx(Y,{checked:A,value:A,id:"is_superuser",className:"relative top-0.5",onCheckedChange:o=>{i({target:{name:"is_superuser",value:o}}),k(o)}})})]})})]})]}),e.jsxs("div",{className:"float-right",children:[e.jsx(X,{variant:"outline",onClick:()=>{x(!1)},className:"mr-3",children:c}),e.jsx(pe,{asChild:!0,children:e.jsx(X,{className:"mt-8",children:E})})]})]})})]})}function ke(){const[r,l]=n.useState(""),[c,E]=n.useState(12),[p,v]=n.useState(1),a=Z(s=>s.setSuccessData),C=Z(s=>s.setErrorData),{userData:z}=n.useContext(le),[B,H]=n.useState(0),{mutate:b}=ye(),{mutate:w}=je(),{mutate:S}=Ee(),u=n.useRef([]);n.useEffect(()=>{setTimeout(()=>{U()},500)},[]);const[y,x]=n.useState(u.current),{mutate:f,isPending:_}=Ue({});function U(){f({skip:c*(p-1),limit:c},{onSuccess:s=>{H(s.total_count),u.current=s.users,x(s.users)},onError:()=>{}})}function T(s,t){E(t),v(s),f({skip:t*(s-1),limit:t},{onSuccess:i=>{H(i.total_count),u.current=i.users,x(i.users)}})}function m(){v(1),E(12),U()}function M(s){if(l(s),s==="")x(u.current);else{const t=u.current.filter(i=>i.username.toLowerCase().includes(s.toLowerCase()));x(t)}}function R(s){b({user_id:s.id},{onSuccess:()=>{m(),a({title:we})},onError:t=>{C({title:Se,list:[t.response.data.detail]})}})}function D(s,t){w({user_id:s,user:t},{onSuccess:()=>{m(),a({title:W})},onError:i=>{C({title:G,list:[i.response.data.detail]})}})}function A(s,t,i){const d=se.cloneDeep(i);d.is_active=!s,w({user_id:t,user:d},{onSuccess:()=>{m(),a({title:W})},onError:o=>{C({title:G,list:[o.response.data.detail]})}})}function k(s,t,i){const d=se.cloneDeep(i);d.is_superuser=!s,w({user_id:t,user:d},{onSuccess:()=>{m(),a({title:W})},onError:o=>{C({title:G,list:[o.response.data.detail]})}})}function V(s){S(s,{onSuccess:t=>{w({user_id:t.id,user:{is_active:s.is_active,is_superuser:s.is_superuser}},{onSuccess:()=>{m(),a({title:_e})},onError:i=>{C({title:te,list:[i.response.data.detail]})}})},onError:t=>{C({title:te,list:[t.response.data.detail]})}})}return e.jsx(e.Fragment,{children:z&&e.jsxs("div",{className:"admin-page-panel flex h-full flex-col pb-8",children:[e.jsx("div",{className:"main-page-nav-arrangement",children:e.jsxs("span",{className:"main-page-nav-title",children:[e.jsx(L,{name:"Shield",className:"w-6"}),Ne]})}),e.jsx("span",{className:"admin-page-description-text",children:ge}),e.jsxs("div",{className:"flex w-full justify-between px-4",children:[e.jsxs("div",{className:"flex w-96 items-center gap-4",children:[e.jsx(ve,{placeholder:"Search Username",value:r,onChange:s=>M(s.target.value)}),r.length>0?e.jsx("div",{className:"cursor-pointer",onClick:()=>{l(""),x(u.current)},children:e.jsx(L,{name:"X",className:"w-6 text-foreground"})}):e.jsx("div",{children:e.jsx(L,{name:"Search",className:"w-6 text-foreground"})})]}),e.jsx("div",{children:e.jsx(ae,{title:"New User",titleHeader:"Add a new user",cancelText:"Cancel",confirmationText:"Save",icon:"UserPlus2",onConfirm:(s,t)=>{V(t)},asChild:!0,children:e.jsx(X,{variant:"primary",children:"New User"})})})]}),_?e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx(Ce,{remSize:12})}):u.current.length===0?e.jsx(e.Fragment,{children:e.jsx("div",{className:"m-4 flex items-center justify-between text-sm",children:"No users registered."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"m-4 h-full overflow-x-hidden overflow-y-scroll rounded-md border-2 bg-background custom-scroll"+(_?" border-0":""),children:e.jsxs(ce,{className:"table-fixed outline-1",children:[e.jsx(oe,{className:_?"hidden":"table-fixed bg-muted outline-1",children:e.jsxs(J,{children:[e.jsx(j,{className:"h-10",children:"Id"}),e.jsx(j,{className:"h-10",children:"Username"}),e.jsx(j,{className:"h-10",children:"Active"}),e.jsx(j,{className:"h-10",children:"Superuser"}),e.jsx(j,{className:"h-10",children:"Created At"}),e.jsx(j,{className:"h-10",children:"Updated At"}),e.jsx(j,{className:"h-10 w-[100px] text-right"})]})}),!_&&e.jsx(de,{children:y.map((s,t)=>e.jsxs(J,{children:[e.jsx(N,{className:"truncate py-2 font-medium",children:e.jsx(q,{content:s.id,children:e.jsx("span",{className:"cursor-default",children:s.id})})}),e.jsx(N,{className:"truncate py-2",children:e.jsx(q,{content:s.username,children:e.jsx("span",{className:"cursor-default",children:s.username})})}),e.jsx(N,{className:"relative left-1 truncate py-2 text-align-last-left",children:e.jsxs(h,{size:"x-small",title:"Edit",titleHeader:`${s.username}`,modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Confirm",icon:"UserCog2",data:s,index:t,onConfirm:(i,d)=>{A(d.is_active,d.id,d)},children:[e.jsx(h.Content,{children:e.jsx("span",{children:"Are you completely confident about the changes you are making to this user?"})}),e.jsx(h.Trigger,{children:e.jsx("div",{className:"flex w-fit",children:e.jsx(ee,{checked:s.is_active})})})]})}),e.jsx(N,{className:"relative left-1 truncate py-2 text-align-last-left",children:e.jsxs(h,{size:"x-small",title:"Edit",titleHeader:`${s.username}`,modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Confirm",icon:"UserCog2",data:s,index:t,onConfirm:(i,d)=>{k(d.is_superuser,d.id,d)},children:[e.jsx(h.Content,{children:e.jsx("span",{children:"Are you completely confident about the changes you are making to this user?"})}),e.jsx(h.Trigger,{children:e.jsx("div",{className:"flex w-fit",children:e.jsx(ee,{checked:s.is_superuser})})})]})}),e.jsx(N,{className:"truncate py-2",children:new Date(s.create_at).toISOString().split("T")[0]}),e.jsx(N,{className:"truncate py-2",children:new Date(s.updated_at).toISOString().split("T")[0]}),e.jsx(N,{className:"flex w-[100px] py-2 text-right",children:e.jsxs("div",{className:"flex",children:[e.jsx(ae,{title:"Edit",titleHeader:`${s.id}`,cancelText:"Cancel",confirmationText:"Save",icon:"UserPlus2",data:s,index:t,onConfirm:(i,d)=>{D(s.id,d)},children:e.jsx(q,{content:"Edit",side:"top",children:e.jsx(L,{name:"Pencil",className:"h-4 w-4 cursor-pointer"})})}),e.jsxs(h,{size:"x-small",title:"Delete",titleHeader:"Delete User",modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Delete",icon:"UserMinus2",data:s,index:t,onConfirm:(i,d)=>{R(d)},children:[e.jsx(h.Content,{children:e.jsx("span",{children:"Are you sure you want to delete this user? This action cannot be undone."})}),e.jsx(h.Trigger,{children:e.jsx(L,{name:"Trash2",className:"ml-2 h-4 w-4 cursor-pointer"})})]})]})})]},t))})]})}),e.jsx(be,{pageIndex:p,pageSize:c,totalRowsCount:B,paginate:(s,t)=>{T(t,s)}})]})]})})}export{ke as default};
